<!DOCTYPE html>

<html lang="en">
<meta charset="utf-8">
<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="css/main.css" type="text/css">
  <title>Flashpoint</title>
</head>
<body>
  <div class="global_button"><i class="fas fa-globe-europe"></i></div>
  <div class="flashpoint_container">
    <div class="flashpoint_map" id="flashpoint_map">
    </div>
    <div class="flashpoint_information" id="flashpoint_information">
      <div class="clearfix top_bar">
        <div class="box close_button">&times;</div>
        <div class="box code"></div>
        <div class="box type"></div>
      </div>
      <div class="flashpoint_information_text">
          <div class="title"></div>
          <div class="belligerents_text">Belligerents</div>
          <div class="belligerents_list"></div>
          <div class="sitrep">Situation</div>
          <div class="description"></div>
          <div class="sources"></div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="maps/admin1.geojson"></script>
  <script type="text/javascript" src="data/conflicts_data.json"></script>
  <script type="text/javascript" src="data/codes_data.json"></script>
  <script type="text/javascript" src="js/flashpoint_functions.js"></script>
  <script type="text/javascript">
    const debug = false;

    // Extracting only what we need, for performance purposes
    const conflict_regions = {};
    for (conflict in conflicts){
      for (region in conflicts[conflict].regions){
        conflict_regions[conflicts[conflict].regions[region]] =  conflict;
      };
    };
    let conflict_regions_features = {
        "type":"FeatureCollection", "features": []
    };
    for (feature in world_map_detail['features']){
      if (world_map_detail['features'][feature].properties.id in conflict_regions){
          conflict_regions_features.features.push(world_map_detail['features'][feature]);
      }
    }
    if (debug) {
      conflict_regions_features = world_map_detail;
    };
    // Loading the basemap and conflict features
    const BaseMap = L.tileLayer("https://api.mapbox.com/styles/v1/rickthesaxon/ckwaqi31o1gqm15od9hbn5xj2/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoicmlja3RoZXNheG9uIiwiYSI6ImNrd2FxZmhsYjNjeXcybnJvdmF0YTlrN3oifQ.HBaSH6YQo3tx-6ZUvy5y_g"),
          ConflictMap = L.geoJson(conflict_regions_features, {noWrap: false, onEachFeature: FeaturesConflictMap, style: StyleConflictMap});

    // Initiating Leaflet map
    const flashpoint_map = L.map("flashpoint_map", {
      center: [40, 0],
      worldCopyJump: true,
      zoom: 3.75,
      minZoom: 3.75,
      maxZoom: 12,
      zoomControl: false,
      doubleClickZoom: true,
      attributionControl: false,
      layers: [
        BaseMap,
        ConflictMap
      ]
    });


    // Button functions
    $("#flashpoint_information .close_button").on("click", function (e) {
        $("#flashpoint_information").css({"width": "0"});
    });
    $(".global_button").on("click", function (e) {
        flashpoint_map.flyTo([40, 0], 3.75, {animate: true, duration: 1.0});
    });

    // Add a text marker for each conflict
    for (conflict in conflicts) {
      addConflictMarker(conflicts[conflict]);
    };

  </script>
</body>
</html>
